from fastapi import FastAPI
from routers.auth import auth_api
from routers.vulnerabilities import vulnerabilitiy_router
from utils.ratelimit import add_calls_to_buckets, BUCKETS
import asyncio

app = FastAPI()
app.include_router(auth_api, tags=["Auth"])
app.include_router(vulnerabilitiy_router, tags=["Vulnerability Retrieval"])

@app.on_event("startup")
async def schedule_bucket_incrementor():
    loop = asyncio.get_event_loop()
    loop.create_task(add_calls_to_buckets())

@app.get("/view")
def view():
    return {"buckets": BUCKETS}